    
<!doctype html>
<html>
<head>
  <title>Go Direct Sensor Readout</title>
  <meta name="description" content="Simple example of connecting to a Vernier Go DirectÂ® Sensor with WebBluetooth and logging out the default sensor value">
  <meta charset="utf-8">
  <script src="https://unpkg.com/@vernier/godirect/dist/godirect.min.umd.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://www.desmos.com/api/v1.3/calculator.js?apiKey=dcb31709b452b1cf9dc26972add0fda6"></script>
<style>
  body {
    background-color: #A1E49E;
  }
   .button {
  background-color: white;
  border: none;
  color: green;
  padding: 15px 32px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  margin: 4px 2px;
  cursor: pointer;
  }
  div.fixed {
  position: fixed;
  top: 0;
  right: 0;
  width: 300px;
  border: 3px solid #73AD21;
}
</style>
  
</head>

<body>
 <div align="left">
   <button  class="button" id="select_device">Select Go Direct Device</button>
   <button  class="button" id="start_collection" onclick="startCollection()" >Start Collection</button>
   <button  class="button" id="stop_collection" onclick="stopCollection()" >Stop Collection</button>
  <pre  id="output"></pre> 
</div>

<div  class = "fixed" id="calculator" style="width: 950px; height: 600px;"></div> 

  <script >
    let elt = document.getElementById('calculator');
    let calc = Desmos.GraphingCalculator(elt);

    let xvalues = [''];
    let yvalues = [''];

    function updateTable () {
      calc.setExpressions([
       { id: 'table1',
         type: 'table',
         columns: [
          {latex: 'x_1', values: xvalues},
          {latex: 'y_1', values: yvalues} ] },
          { id: 'regression', latex: 'y_1~mx_1+b'}
      ]);                                      
    }
    
    updateTable();
   
  </script>
  
  <script>
    const selectDeviceBtn = document.querySelector('#select_device');
    const output = document.querySelector('#output'); 
    let count = 0;
    let gdxDevice = "";
    
    const selectDevice = async () => {
      try {
        gdxDevice = await godirect.selectDevice();
        output.textContent += `\n Connected to `+gdxDevice.name;
        output.textContent += `\n Press start to start collection \n`;
      } catch (err) {
        console.error(err);
      }
    };
     const startCollection = async () => {
       
        const enabledSensors = gdxDevice.sensors.filter(s => s.enabled);
            enabledSensors.forEach(sensor => {
            sensor.on('value-changed', (sensor) => {
         
            // log the sensor name, new value and units.
            console.log(`Sensor: ${sensor.name} value: ${sensor.value} units: ${sensor.unit}`);
            // output the change to the pre tag
          output.textContent += `\n Sensor: ${sensor.name} value: ${sensor.value} units: ${sensor.unit}`;
          count += 0.5;
          let y = sensor.value;
          let x = count;
           // var mathCoordinates = calculator.pixelsToMath({x: x, y: y});
            xvalues.push(x.toPrecision(4));
            yvalues.push(y.toPrecision(4));
  
            updateTable();
                
          });
        });
       
     } 
     const stopCollection = async () => {
         gdxDevice.close();
        
         gdxDevice.on('device-closed', () => {
          output.textContent += `\n\n Disconnected from `+gdxDevice.name+`\n`;
        });
         
       }
    
    selectDeviceBtn.addEventListener('click', selectDevice);
     
  </script>
</body>
</html>